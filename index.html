<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord PnL Auto-Submitter</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8">

    <div id="app" class="max-w-2xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-gray-900">
                \$10K Challenge Auto-Submitter
            </h1>
            <p class="mt-2 text-md text-indigo-600">Enter your PnL, click submit, and it posts automatically to Discord!</p>
        </header>

        <!-- Webhook Configuration -->
        <div class="card bg-yellow-50 p-4 rounded-lg mb-6 border border-yellow-200">
            <h2 class="text-xl font-semibold mb-2 text-yellow-800 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Webhook Setup (One-Time)
            </h2>
            <p class="text-sm text-yellow-700 mb-3">You must get a Webhook URL from your Discord server settings and paste it below. It will be saved automatically.</p>
            <div>
                <label for="webhookUrl" class="block text-sm font-medium text-yellow-700">Discord Webhook URL</label>
                <input type="url" id="webhookUrl" required placeholder="https://discord.com/api/webhooks/..."
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border text-gray-700">
            </div>
        </div>

        <!-- Submission Form -->
        <div class="card bg-white p-6 rounded-lg mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Your Daily Trading Entry</h2>
            <form id="pnl-form" class="space-y-4">
                <div>
                    <label for="displayName" class="block text-sm font-medium text-gray-700">Your Trading Name</label>
                    <input type="text" id="displayName" required placeholder="e.g., TraderX or JaneDoe"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                </div>
                <div>
                    <label for="pnlAmount" class="block text-sm font-medium text-gray-700">Daily PnL (\$)</label>
                    <input type="number" id="pnlAmount" required placeholder="e.g., 45.75 or -20.50" step="0.01"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                </div>
                <div>
                    <label for="note" class="block text-sm font-medium text-gray-700">Key Insight/Lesson Learned (Optional)</label>
                    <textarea id="note" rows="2" placeholder="My strategy was clean, but I missed the exit. Patience needed!"
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"></textarea>
                </div>
                <button type="submit" id="submit-button"
                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                    Post Directly to Discord
                </button>
            </form>
        </div>
    </div>

    <!-- Custom Modal for Messages -->
    <div id="message-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
            <h3 id="modal-title" class="text-lg font-bold mb-3 text-gray-900">Message</h3>
            <p id="modal-content" class="text-gray-700 mb-4"></p>
            <button onclick="closeModal()" class="w-full py-2 px-4 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Close</button>
        </div>
    </div>

    <script>
        // --- Utility Functions ---

        const submitButton = document.getElementById('submit-button');

        function showModal(title, content) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-content').textContent = content;
            document.getElementById('message-modal').classList.remove('hidden');
        }

        window.closeModal = function() {
            document.getElementById('message-modal').classList.add('hidden');
        }

        function setButtonLoading(isLoading) {
            submitButton.disabled = isLoading;
            submitButton.textContent = isLoading ? 'Posting...' : 'Post Directly to Discord';
            submitButton.classList.toggle('bg-gray-400', isLoading);
            submitButton.classList.toggle('bg-indigo-600', !isLoading);
            submitButton.classList.toggle('hover:bg-indigo-700', !isLoading);
        }

        // --- Discord Webhook Logic ---

        async function sendDiscordWebhook(name, pnl, note, webhookUrl) {
            setButtonLoading(true);

            const amount = parseFloat(pnl);
            const isPositive = amount >= 0;
            const absAmount = Math.abs(amount).toFixed(2);
            const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
            
            // Discord colors: GREEN (3066993), RED (15158332)
            const color = isPositive ? 3066993 : 15158332;

            const payload = {
                username: `${name.trim()} - Challenge Poster`,
                avatar_url: "https://placehold.co/100x100/4f46e5/ffffff?text=TT", // Placeholder avatar
                embeds: [{
                    title: `ðŸŽ¯ Daily PnL Submission: ${name.trim()}`,
                    color: color,
                    fields: [
                        { 
                            name: "PnL Amount", 
                            value: `**${isPositive ? '+' : '-'}\$${absAmount}**`, 
                            inline: true 
                        },
                        { 
                            name: "Date Posted", 
                            value: today, 
                            inline: true 
                        }
                    ],
                    footer: {
                        text: "Discipline. Consistency. 'Pay'tience."
                    }
                }]
            };

            if (note.trim()) {
                payload.embeds[0].fields.push({
                    name: "Key Insight/Lesson Learned",
                    value: `*${note.trim()}*`,
                    inline: false
                });
            }

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (response.ok) {
                    showModal('Success!', `Your PnL has been posted to Discord!`);
                    document.getElementById('pnl-form').reset();
                } else {
                    const errorText = await response.text();
                    console.error("Discord Webhook Error:", response.status, errorText);
                    showModal('Submission Failed', `Discord returned an error (${response.status}). Please check your Webhook URL.`);
                }
            } catch (error) {
                console.error("Network or Fetch Error:", error);
                showModal('Submission Failed', 'Could not connect to the Discord Webhook. Check your URL and network connection.');
            } finally {
                setButtonLoading(false);
            }
        }

        // --- Event Listener ---

        document.addEventListener('DOMContentLoaded', () => {
            const webhookUrlInput = document.getElementById('webhookUrl');
            const form = document.getElementById('pnl-form');

            // 1. Load Webhook URL from local storage
            const savedWebhook = localStorage.getItem('discordWebhookUrl');
            if (savedWebhook) {
                webhookUrlInput.value = savedWebhook;
            }

            // 2. Save Webhook URL on change
            webhookUrlInput.addEventListener('input', (e) => {
                localStorage.setItem('discordWebhookUrl', e.target.value.trim());
            });

            // 3. Handle Form Submission
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const webhookUrl = webhookUrlInput.value.trim();
                const name = document.getElementById('displayName').value;
                const pnl = document.getElementById('pnlAmount').value;
                const note = document.getElementById('note').value;

                if (!webhookUrl || !webhookUrl.startsWith('https://discord.com/api/webhooks/')) {
                    showModal('Configuration Required', 'Please enter a valid Discord Webhook URL first.');
                    return;
                }
                
                if (!name.trim() || isNaN(parseFloat(pnl))) {
                    showModal('Input Error', 'Please ensure you have entered a Trading Name and a valid number for Daily PnL.');
                    return;
                }

                sendDiscordWebhook(name, pnl, note, webhookUrl);
            });
        });
    </script>
</body>
</html>
